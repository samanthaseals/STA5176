---
title: "One-Way ANOVA - Week 5, Lecture 1"
author: "Dr. Seals"
format: html
self-contained: true
editor: source
---

```{r setup, echo = TRUE, warnings = FALSE, message = FALSE}
library(tidyverse)
library(gsheet)
library(pgirmess)
library(car)
```

**An agricultural researcher investigated two new herbicides and their effects on crop yields of tomatoes, which can be demolished by the [tomato hornworm](https://extension.umn.edu/yard-and-garden-insects/tomato-hornworms) in mere hours. There were three areas for the experiment: an area for herbicide A, an area for herbicide B, and an area for no herbicide at all (control). At the end of the growing season, the yields (in bushels per acre) were measured and are available in the following [Google Sheet](https://docs.google.com/spreadsheets/d/1CFyuuWy-4YmVU3wkYuC8Uf3xW3qkpCnpF468NjBAhbY/edit#gid=0).**

```{r, echo = TRUE}
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/1CFyuuWy-4YmVU3wkYuC8Uf3xW3qkpCnpF468NjBAhbY/edit#gid=0"))
```

#### 1. Construct the 95% confidence interval for the average yield for each group (A, B, control).

```{r, echo=TRUE}
t.test(data$Herbicide1)
t.test(data$Herbicide2)
t.test(data$Control)
```

The 95% CI for herbicide A is (82.12, 88.43).

The 95% CI for herbicide B is (88.34, 92.16).

The 95% CI for the control is (84.66, 90.18)

#### 2. Challenge! Construct a graph to display all confidence intervals.

```{r, echo = TRUE}
group <- c("Herbicide A", "Herbicide B", "Control")
mean <- c(85.27667, 90.24667, 87.42333)
LCL <- c(82.12035, 88.22621, 84.66827)
UCL <- c(88.43299, 92.15712, 90.17840)
CI <- tibble(group, LCL, mean, UCL)

CI %>% ggplot(aes(x=factor(group), y=mean)) + 
  geom_errorbar(aes(ymin=LCL, ymax=UCL), width=.1, size=1) +
  geom_point(size=4) + 
  ylab("Average Yield") +
  xlab("Treatment") +
  theme_bw()+
  theme(text = element_text(size=20))
```

#### 3. Challenge! Why should we be cautious when using the individual CIs found in Q1 and displayed in Q2 to directly compare the three groups?

Because the CIs were not found simultaneously... we are inflating the type I error rate if we do not construct CIs simultaneously (i.e., spread the $\alpha$ out over the three intervals).

#### 4. Use the appropriate hypothesis test to show that there is a difference in the average yield between the three groups.

```{r, echo = TRUE}
long <- data %>%                                
  pivot_longer(cols = c("Herbicide1", "Herbicide2", "Control"),
               names_to = "Group",
               values_to = "Yield")
m1 <- aov(Yield ~ Group, data = long)
summary(m1)
```

**Hypotheses**

- $H_0: \mu_\text{A} = \mu_{\text{B}} = \mu_{\text{Ctrl}}$
- $H_1:$ at least one $\mu_i$ is different.

**Test Statistic and *p*-Value**

- $F_0=3.677$
- $p = 0.029$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$.

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that there is at least one difference between the three treatments.

#### 5. Construct and test the following contrasts for the following comparisons:

```{r, echo = TRUE}
long <- long %>% mutate(Group = as.factor(Group))
contrasts(long$Group)
contrasts(long$Group) <- cbind(c(0, 1, -1),
                               c(-0.5, -0.5, 1))
summary.aov(m1, split=list(Group=list("A vs. B"=1, 
                                      "A + B vs. Ctrl"=2)))
```

##### a. Herbicide A vs. Herbicide B.


**Hypotheses**

- $H_0: \mu_\text{A} = \mu_{\text{B}}$
- $H_1: \mu_\text{A} \ne \mu_{\text{B}}$

**Test Statistic and *p*-Value**

- $F_0=3.677$
- $p = 0.029$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05 \text{ and} \alpha_{\text{B}}=0.025$.

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that there is at least one difference between the three treatments.

##### b. Herbicide A and Herbicide B vs. Control

**Hypotheses**

- $H_0: \mu_\text{A} + \mu_{\text{B}} = \mu_{\text{Ctrl}}$
- $H_1: \mu_\text{A} + \mu_{\text{B}} \ne \mu_{\text{Ctrl}}$.

**Test Statistic and *p*-Value**

- $F_0=0.045$
- $p = 0.832$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05 \text{ and} \alpha_{\text{B}}=0.025$.

**Conclusion/Interpretation**

- Fail to reject $H_0$ at the $\alpha=0.05$ level. There is not sufficient evidence to suggest that herbicides A and B, together, are different from the control group.

#### 6. Use the appropriate posthoc test to perform all pairwise comparisons of yield.

```{r, echo = TRUE}
round(TukeyHSD(m1)$Group, 3)
```

Only herbicides 1 and 2 are different from one another. Neither herbicide is different from the control.

#### 7. Use the appropriate posthoc test to only compare the individual herbicides to the control.

```{r, echo = TRUE}
library(DescTools)
DunnettTest(x=long$Yield, 
            g=long$Group, 
            control = "Control")
```
Neither herbicide is different from the control.




