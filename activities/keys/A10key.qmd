---
title: "Two-Way ANOVA - Week 6, Lecture 2"
author: "Dr. Seals"
format: html
self-contained: true
editor: source
---

## Q1:

**Recall the advertising data from the last activity; you showed that there was an interaction between age and product type.**

```{r, echo = TRUE, warning = FALSE, message = FALSE}
library(tidyverse)
library(gsheet)
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/16_HOSmIBDD9oYY1oBQ5Df6eFH9nT6GgO1UWcbMZNLUo/edit?usp=sharing"))
```

a. Construct the profile plot for this data.

```{r, echo = TRUE}
# mean(data$`A1-P1`) # 22.9
# mean(data$`A1-P2`) # 23.1
# mean(data$`A2-P1`) # 19.6
# mean(data$`A2-P2`) # 30.5
# mean(data$`A3-P1`) # 21.9
# mean(data$`A3-P2`) # 45.6

p1 <- c(22.9, 19.6, 21.9)
p2 <- c(23.1, 30.5, 45.6)
age <- c("5-6", "7-8", "9-10")

graph <- tibble(age, p1, p2)

graph %>% ggplot(aes(x = age, group = 1)) +
  geom_line(aes(y = p1)) +
  geom_line(aes(y = p2)) + 
  geom_text(aes(x = "9-10", y = 23, label = "Cereal")) +
  geom_text(aes(x = "9-10", y = 46.5, label = "Video Games")) +
  labs(x = "Age Group",
       y = "Average Attention Span (sec)") + 
  theme_bw()
```

b. (Challenge!) Perform Tukey's test to determine which treatment groups are significantly different. Test at the $\alpha=0.05$ level.

```{r, echo = TRUE}
c1 <- data %>% select(`A1-P1`) %>%
  mutate(age = "5-6 years",
         product = "cereal") %>%
  rename(attn = `A1-P1`)
c2 <- data %>% select(`A2-P1`) %>%
  mutate(age = "7-8 years",
         product = "cereal") %>%
  rename(attn = `A2-P1`)
c3 <- data %>% select(`A3-P1`) %>%
  mutate(age = "9-10 years",
         product = "cereal") %>%
  rename(attn = `A3-P1`)
c4 <- data %>% select(`A1-P2`) %>%
  mutate(age = "5-6 years",
         product = "video game") %>%
  rename(attn = `A1-P2`)
c5 <- data %>% select(`A2-P2`) %>%
  mutate(age = "7-8 years",
         product = "video game") %>%
  rename(attn = `A2-P2`)
c6 <- data %>% select(`A3-P2`) %>%
  mutate(age = "9-10 years",
         product = "video game") %>%
  rename(attn = `A3-P2`)
long <- rbind(c1, c2, c3, c4, c5, c6)

m1 <- aov(attn ~ age + product + age:product, data = long)

round(TukeyHSD(m1)$`age:product`, 3)
```
Within cereal: 

- none of the age groups are significantly different (all *p* > 0.05)

Within video game: 

- 5-6 years are not different from 7-8 years (*p* = 0.748)
- 5-6 years are different from 9-10 years (*p* = 0.002)
- 7-8 years are not different from 9-10 years (*p* = 0.076)

Within age groups:

- In 5-6 years, there is not a difference between cereal and video games (*p* > 0.999)
- In 7-8 years, there is not a difference between cereal and video games (*p* = 0.351)
- In 9-10 years, there is a difference between cereal and video games (*p* = 0.001)

c. Write a short paragraph to explain your results to the advertising researchers.

d. Graphically assess the ANOVA assumptions -- is ANOVA appropriate here?

```{r, echo=TRUE}
plot(fitted(m1), resid(m1))
```

The variance assumption looks okay.

```{r, echo = TRUE}
hist(resid(m1))
```

The histogram looks mostly okay

```{r, echo = TRUE}
qqnorm(resid(m1))
qqline(resid(m1)) 
```

The qq plot looks okay.

Yes, we have satisfied the ANOVA assumptions.

## Q2:

**Recall the tomato data from the last activity; you showed that there was not an interaction between shading and phase of growth and that there was at least one main effect.**

```{r, echo = TRUE}
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/1kUxXje3cTl_PZFQcg8FvESo34UuGNwm1GrKGc4HN0_A/edit?usp=sharing")) %>%
  mutate(PctShade = as.factor(PctShade),
         Phase = as.factor(Phase))
```

a.  (Challenge!) Construct the profile plot for this data.

```{r, echo = TRUE}
# find means
means <- data %>% group_by(Phase, PctShade) %>% summarize(mean = mean(Yield)) %>% ungroup()

# separate into individual datasets
early <- means %>% filter(Phase == "Early") %>% rename(Early = mean) %>% select(-Phase)
late <- means %>% filter(Phase == "Late")  %>% rename(Late = mean) %>% select(-Phase)
middle <- means %>% filter(Phase == "Middle") %>% rename(Middle = mean) %>% select(-Phase)

# merge back together
graph <- full_join(early, middle, by = "PctShade")
graph <- full_join(graph, late, by = "PctShade") 

graph %>% ggplot(aes(x = PctShade, group = 1)) +
  geom_line(aes(y = Early), color = "pink") +
  geom_line(aes(y = Middle), color = "blue") + 
  geom_line(aes(y = Late), color = "purple") + 
  geom_text(aes(x = 4.25, y = 66.5, label = "Middle")) +
  geom_text(aes(x = 4.25, y = 64, label = "Late")) +
  geom_text(aes(x = 4.25, y = 55, label = "Early")) +
 labs(x = "Percent of Shade",
      y = "Average Yield") +
  theme_bw()
```

b. If there is a main effect of shading, perform Tukey's test to determine which levels of shading are significantly different. Test at the $\alpha=0.10$ level.

```{r, echo = TRUE}
m2 <- lm(Yield ~ Phase + PctShade, data = data)
anova(m2)
```

There is not a main effect of shading.

c.  If there is a main effect of phase of growth, perform Tukey's test to determine which phases of growth are significantly different. Test at the $\alpha=0.10$ level.

```{r, echo = TRUE}
anova(m2)
```

There is a main effect of phase.

```{r, echo = TRUE}
m2 <- aov(Yield ~ Phase + PctShade, data = data)
round(TukeyHSD(m2)$Phase, 3)
```

There is only a difference between early and late phases (*p* = 0.094).

d. Write a short paragraph to explain your results to the horticulturist. 

e. Graphically assess the ANOVA assumptions -- is ANOVA appropriate here?


```{r, echo=TRUE}
plot(fitted(m2), resid(m2))
```

The variance assumption looks okay.

```{r, echo = TRUE}
hist(resid(m2))
```

The histogram looks mostly okay

```{r, echo = TRUE}
qqnorm(resid(m2))
qqline(resid(m2)) 
```

The qq plot looks okay.

Yes, ANOVA is a valid choice.
