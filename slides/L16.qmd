---
title: "Contingency Tables"
subtitle: "STA5176: Statistical Modeling"
author: "Dr. Seals"
format: 
  revealjs:
    theme: dark2
    self-contained: false
    slide-number: false
    footer: "[STA5176 - Statistical Modeling](https://samanthaseals.github.io/STA5176)"
    width: 1600
    height: 900
    chalkboard: true
    df-print: paged
    html-math-method: katex
editor: source
---

## Introduction

- In the categorical data analysis module, we have discussed:

    - One proportion
    - Two proportions
    - Goodness of fit (multiple proportions)
    
- Today, we will expand into contingency tables.

## Contingency Tables

- A *R* $\times$ *C* contingency table is a table with *R* rows and *C* columns

    - The variable in the rows has *R* categories
    
    - The variable in the columns has *C* categories
    
- Assignment to *R* or *C* is arbitrary.

  - The test statistic for a *R* $\times$ *C* is the same as the test statistic for a *C* $\times$ *R*

## Contingency Tables

<center><img src="images/L16a.png" width = 800></center>

## Test for Independence

- We will now extend the $\chi^2$ test to examine independence of two variables.

    - e.g., does ice cream flavor preference depend on hair color?  
    
- We will again use observed values and expected values.

- The calculation of the expected value is now different:

$$ E_{ij} = \frac{\text{row total} \times \text{column total}}{\text{grand total}} $$

- The assumption to apply the $\chi^2$ distribution is now that $E_{ij} \ge 5$ $\forall \ i$.

## Hypothesis Test: Definition

**Hypotheses**

- $H_0$: There is not a relationship between [var 1] and [var 2].
- $H_1$: There is a relationship between [var 1] and [var 2].

**Test Statistic**

$$\chi_0^2 = \sum_{i=1}^k \frac{(O_i-E_i)^2}{E_i} $$

**p-Value**

- $p = \text{P}[\chi^2_{(r-1)(c-1)} \ge \chi^2_0]$

## Hypothesis Test: R Syntax

- If given the contingency table, we can enter it in a `matrix()` (see example) and use the `chisq.test()` function.

```{r, echo = TRUE, eval = FALSE}
chisq.test([matrix name])
```

- If given raw data, we can use the [`CrossTable()`](https://www.rdocumentation.org/packages/gmodels/versions/2.18.1.1/topics/CrossTable) function in the [`gmodels`](https://www.rdocumentation.org/packages/gmodels/versions/2.18.1.1) package.

    - Note: this function replicates PROC FREQ from SAS :)

```{r, echo = TRUE, eval = FALSE}
CrossTable([dataset$row var], [dataset$col var], 
           prop.chisq= FALSE,  # turn off proportion contributed to chi-square statistic
           prop.r = FALSE,  # turn off row proportions
           prop.t = FALSE, # turn off total proportions
           chisq = TRUE) # request chi-square test
```

## Hypothesis Test: Marriage

- Consider the following data on happiness in a marriage,

|  | Married | Widowed | Div./Sep. | Never Married |
|---|---|---|---|---|---|
| Very Happy | 600 | 63 | 112 | 114 |
| Pretty Happy | 720 | 142 | 355 | 459 |
| Not Too Happy | 93 | 51 | 119 | 127 |

- Use the $\chi^2$ test for independence to determine if happiness depends on marital status.

```{r, echo = TRUE}
observed_table <- matrix(c(600, 63, 112, 144,
                           720, 142, 355, 459,
                           93, 51, 119, 127), 
                         nrow = 3, ncol = 4, byrow = T)
chisq.test(observed_table)
```

## Hypothesis Test: Marriage

**Hypotheses**

- $H_0$: Happiness does not depend on relationship status.
- $H_1$: Happiness depends on relationship status.

**Test Statistic and *p*-Value**

- $\chi_0^2=224.12$; $\ p < 0.001$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that happiness depends on relationship status.

## Hypothesis Test: Jackson Heart Study

- Recall the Jackson Heart Study dataset. 

```{r, warning = FALSE}
library(tidyverse)
library(gsheet)
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/1H3TP-2SBMGleriJLESOe1cdCjtSj2F76bUh5iBqC8tI/edit#gid=2142000894"))
```

- Let's determine if there is a difference between the proportion of male and female drinkers.

```{r, echo = TRUE}
library(gmodels)
CrossTable(data$alc, data$sex, prop.chisq= FALSE, prop.r = FALSE, prop.t = FALSE, chisq = TRUE)
```

## Hypothesis Test: Jackson Heart Study

**Hypotheses**

- $H_0$: The proportion of males and females that drink is equal
- $H_1$: The proportion of males and females that drink is not equal.

**Test Statistic and *p*-Value**

- $\chi_0^2=89.297$; $\ p < 0.001$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that the proportion of male and female drinkers is different.

## Fisher's Exact

- What happens if we do not meet the assumption for the $\chi^2$ test?

- We can use Fisher's Exact test.

- This directly computes a probability using the contingency table.

    - i.e., we will not have a test statistic.
    
- These are difficult to calculate by hand due to large factorials.

    - We will skip formulae and trust R :)
    
## Hypothesis Test: R Syntax


- If given the contingency table, we can enter it in a `matrix()` (see example) and use the `fisher.test()` function.

```{r, echo = TRUE, eval = FALSE}
chisq.test([matrix name])
```

- If given raw data, we can use the [`CrossTable()`](https://www.rdocumentation.org/packages/gmodels/versions/2.18.1.1/topics/CrossTable) function in the [`gmodels`](https://www.rdocumentation.org/packages/gmodels/versions/2.18.1.1) package.

    - Note: this function replicates PROC FREQ from SAS :)

```{r, echo = TRUE, eval = FALSE}
CrossTable([dataset$row var], [dataset$col var], 
           prop.chisq= FALSE,  # turn off proportion contributed to chi-square statistic
           prop.r = FALSE,  # turn off row proportions
           prop.t = FALSE, # turn off total proportions
           fisher = TRUE) # request chi-square test
```

## Hypothesis Test: CVD Death and Diet

- Consider the following data from a retrospective study examining cause of death (CVD vs. not CVD) and the type of diet the person ate (high vs. low salt).

| | High Salt | Low Salt |
|---|---|---|
| Non-CVD | 2 | 23 |
| CVD | 5 | 30 |

- Is there a relationship between the two?

```{r, echo = TRUE, eval = FALSE}
observed_table <- matrix(c(2, 23,
                           5, 30), 
                         nrow = 2, ncol = 2, byrow = T)
chisq.test(observed_table)
```

<center><img src="images/L16b.png" width = 800></center>


## Hypothesis Test: CVD Death and Diet

- Consider the following data from a retrospective study examining cause of death (CVD vs. not CVD) and the type of diet the person ate (high vs. low salt).

| | High Salt | Low Salt |
|---|---|---|
| Non-CVD | 2 | 23 |
| CVD | 5 | 30 |

- Is there a relationship between the two?

```{r, echo = TRUE}
observed_table <- matrix(c(2, 23,
                           5, 30), 
                         nrow = 2, ncol = 2, byrow = T)
fisher.test(observed_table)
```

## Hypothesis Test: CVD Death and Diet

**Hypotheses**

- $H_0$: CVD death does not depend on low or high salt diet.
- $H_1$: CVD death does depend on low or high salt diet.

***p*-Value**

- $\ p = 0.688$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$

**Conclusion/Interpretation**

- Fail to reject $H_0$ at the $\alpha=0.05$ level. There is not sufficient evidence to suggest that CVD death depends on amount of salt in diet.

## Hypothesis Test: Jackson Heart Study

- Let's apply the Fisher's exact test to the JHS data (even though it is not needed):

```{r, echo = TRUE}
CrossTable(data$alc, data$sex, prop.chisq= FALSE, prop.r = FALSE, prop.t = FALSE, fisher = TRUE)
```


## Hypothesis Test: Jackson Heart Study

**Hypotheses**

- $H_0$: The proportion of males and females that drink is equal
- $H_1$: The proportion of males and females that drink is not equal.

**Test Statistic and *p*-Value**

- $\ p < 0.001$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that the proportion of male and female drinkers is different.




































































































