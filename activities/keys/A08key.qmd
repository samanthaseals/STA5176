---
title: "ANOVA Assumptions and the Kruskal-Wallis - Week 5, Lecture 2"
author: "Dr. Seals"
format: html
self-contained: true
editor: source
---

**Recall the agricultural data from the ANOVA activity available in the following [Google Sheet](https://docs.google.com/spreadsheets/d/1CFyuuWy-4YmVU3wkYuC8Uf3xW3qkpCnpF468NjBAhbY/edit#gid=0).**

```{r, echo = TRUE}
library(tidyverse)
library(gsheet)
library(pgirmess)
library(car)
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/1CFyuuWy-4YmVU3wkYuC8Uf3xW3qkpCnpF468NjBAhbY/edit#gid=0"))
long <- data %>%                                
  pivot_longer(cols = c("Herbicide1", "Herbicide2", "Control"),
               names_to = "Group",
               values_to = "Yield")
m1 <- lm(Yield ~ Group, data = long)
```

#### 1. State the ANOVA assumptions mathematically.

$$\varepsilon_{ij} \overset{\text{iid}}{\sim} N(0, \sigma^2)$$

#### 2. Explain how to check the ANOVA assumptions.

Normality is checked with the histogram and/or qq plot.

Variance is checked with the scatterplot and/or the Brown-Forsythe-Levene.

#### 3. Assess the ANOVA assumptions for the agricultural data, graphically. In addition to providing the relevant graphs, you must provide an assessment for each assumption.

```{r, echo=TRUE}
plot(fitted(m1), resid(m1))
```

The variance assumption looks okay.

```{r, echo = TRUE}
hist(resid(m1))
```

The histogram looks okay.

```{r, echo = TRUE}
qqnorm(resid(m1))
qqline(resid(m1)) 
```

The qq plot looks okay.

#### 4. Use the appropriate hypothesis test to assess the variance assumption. Test at the $\alpha=0.05$ level.

```{r, echo=TRUE}
leveneTest(Yield ~ Group, data = long, center = median)
```

**Hypotheses**

- $H_0: \sigma^2_{\text{A}} = \sigma^2_{\text{B}} = \sigma^2_{\text{Ctrl}}$
- $H_1:$ at least one $\sigma^2_i$ is different.

**Test Statistic and *p*-Value**

- $F_0=3.170$
- $p = 0.047$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$.

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that at least one variance is not equal. Thus, we have broke the variance assumption.

#### 5. Provide an overall assessment -- do we meet the assumptions to use ANOVA?

No -- we failed the variance assumption with the formal BFL test.

#### 6. Perform the Kruskal-Wallis to determine if there is a difference between the treatment groups. Test at the $\alpha=0.05$ level.

```{r, echo=TRUE}
kruskal.test(Yield ~ Group, data = long)
```

**Hypotheses**

- $H_0: M_\text{A} = M_{\text{B}} = M_{\text{Ctrl}}$
- $H_1:$ at least one $M_i$ is different.

**Test Statistic and *p*-Value**

- $\chi^2_0=8.63$
- $p = 0.013$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$.

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that there is at least one difference between the three treatments.

#### 7. Perform the Kruskal-Wallis post-hoc test to determine what differences exist between groups. Test at the $\alpha=0.05$ level.

```{r, echo=TRUE}
kruskalmc(Yield ~ Group, data = long)
```

Like in ANOVA, only herbicides A and B are different from one another. Neither is different from the control group.

#### 8. Challenge! Construct a graph (or multiple graphs) to aid in explaining this to the agricultural researcher.

#### 9. Write a summary paragraph, appropriate for the agricultural researcher (i.e., not a statistician), using the results that are **appropriate for the data**. Hint: you will summarize either your ANOVA findings from the previous activity *or* your Kruskal-Wallis findings from this activity.

If you stated that the ANOVA assumptions were met $\to$ report ANOVA results.

If you stated that the ANOVA assumptions were not met $\to$ report KW results.
