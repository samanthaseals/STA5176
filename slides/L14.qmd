---
title: "One and Two Proportions"
subtitle: "STA5176: Statistical Modeling"
author: "Dr. Seals"
format: 
  revealjs:
    theme: dark2
    self-contained: false
    slide-number: false
    footer: "[STA5176 - Statistical Modeling](https://samanthaseals.github.io/STA5176)"
    width: 1600
    height: 900
    chalkboard: true
    df-print: paged
    html-math-method: katex
editor: source
---

## Introduction

- Before today, we have focused on the analysis of continuous data.

    - When observations on a quantitative random variable can assume any one of the uncountable number of values in a line interval, the variable is called a **continuous random variable**.
    
- Today, we will begin analyzing categorical data, a type of discrete random variable.

    - When observations on a quantitative random variable can assume only a countable number of values, the variable is called a **discrete random variable**.
    
## Bernoulli Experiments: One Population

- Bernoulli experiments have two possible outcomes: success and failure.

    - "Success" is just the event of interest; "failure" is the event *not* happening.=
    
- When we have $n$ independent Bernoulli experiments, 
$$ \text{P}[y] = \frac{n!}{y! (n-y!)} \pi^y (1-\pi)^{n-y}, $$

- where

    - $y$ is the number of successes and
    - $n$ is the number of trials
    - $\pi$ = P[success] and $(1-\pi)$ = P[failure]
    
## Bernoulli Experiments: One Population

- But... $\pi$ is the *population* probability of success.

- We will estimate $\pi$ with $\hat{\pi}$:

$$ \hat{\pi} = \frac{y}{n} $$

- If we have a "large sample" (i.e., $n\pi \ge 5$ **and** $n(1-\pi) \ge 5$),

$$ \hat{\pi} \sim N \left( \pi, \sqrt{\frac{\pi(1-\pi)}{n}} \right) $$

## Hypothesis Testing: Test for One Proportion

**Hypotheses**

|       Right Tail       |       Left Tail        |       Two Tails        |
|:----------------------:|:----------------------:|:----------------------:|
| $H_0: \ \pi \le \pi_0$ | $H_0: \ \pi \ge \pi_0$ |  $H_0: \ \pi = \pi_0$  |
|  $H_1: \ \pi > \pi_0$  |  $H_1: \ \pi < \pi_0$  | $H_1: \ \pi \ne \pi_0$ |

**Test Statistic**

$$ z_0 = \frac{\hat{\pi}-\pi_0}{s / \sigma}, $$

- where 
$$ \sigma = \sqrt{\frac{\pi_0 (1-\pi_0)}{n}} $$


## Hypothesis Testing: R Syntax

- We will use either the [`binom.test()`](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/binom.test) function or the [`prop.test()`](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/prop.test) function.

- If we have $n \le 30$,

```{r, echo = TRUE, eval = FALSE}
binom.test(x = [number of successes], 
           n = [sample size], 
           p = [hypothesized proportion], 
           alternative = [alternative])
```

- If we have $n > 30$,

```{r, echo = TRUE, eval = FALSE}
prop.test(x = [number of successes], 
          n = [sample size], 
          p = [hypothesized proportion], 
          alternative = [alternative],
          correct=FALSE)
```

## Hypothesis Testing: Police 

- A police department supplies its officers with a flashlight that contains four batteries. The company that manufacturers the flashlights is required to verify the reliability of the batteries that are included in the flashlight when it is shipped to the police department. The quality control department states that they expect 15% of its batteries to be defective. The four batteries were inspected in a random sample of 300 flashlights, and found that 200 were defective.

- What pieces do we need?

## Hypothesis Testing: Police

- A police department supplies its officers with a flashlight that contains four batteries. The company that manufacturers the flashlights is required to verify the reliability of the batteries that are included in the flashlight when it is shipped to the police department. The quality control department states that <span style="color:pink">they expect 15% of its batteries to be defective</span>. The <span style="color:pink">four batteries</span> were inspected in a <span style="color:pink">random sample of 300 flashlights</span>, and found that <span style="color:pink">200 were defective</span>.

- Where do these go in our R syntax? We need:

    - $x$
    - $n$
    - $p$
    - alternative
    
- Are we using `binom.test()` or `prop.test()`? Why?

## Hypothesis Testing: Police

- A police department supplies its officers with a flashlight that contains four batteries. The company that manufacturers the flashlights is required to verify the reliability of the batteries that are included in the flashlight when it is shipped to the police department. The quality control department states that <span style="color:pink">they expect 15% of its batteries to be defective</span>. The <span style="color:pink">four batteries</span> were inspected in a <span style="color:pink">random sample of 300 flashlights</span>, and found that <span style="color:pink">200 were defective</span>.

- So, for our R syntax:

    - $x$ = 200
    - $n$ = 1200
    - $p$ = 0.15
    - alternative = "greater"
    
## Hypothesis Testing: Police

```{r, echo = TRUE}
prop.test(x = 200, 
          n = 1200, 
          p = 0.15, 
          alternative = "greater",
          correct=FALSE)
```

## Hypothesis Testing: Police {.smaller}

**Hypotheses**

- $H_0: \ \pi \le 0.15$ 
- $H_1: \ \pi > 0.15$

**Test Statistic and *p*-Value**

- $\chi^2_0 = 2.485$ or $z_0 = \sqrt{2.485} = `r round(sqrt(2.485),3)`$
- $p = 0.057$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$

**Conclusion/Interpretation**

- Fail to reject $H_0$ at the $\alpha=0.05$ level. There is not sufficient evidence to suggest that the failure rate is higher than 15%.

## Hypothesis Testing: Jackson Heart Study

- Recall the Jackson Heart Study data. Do more than half of the participants take medication for high blood pressure? We will analyze the variable *BPmeds*, where 1=yes and 0=no.

```{r, echo = TRUE}
library(tidyverse)
library(gsheet)
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/1H3TP-2SBMGleriJLESOe1cdCjtSj2F76bUh5iBqC8tI/edit#gid=2142000894"))

data %>% count(BPmeds)
```

## Hypothesis Testing: Jackson Heart Study

```{r, echo = TRUE}
prop.test(x = 1331, 
          n = 1302+1331, 
          p = 0.15, 
          alternative = "greater",
          correct=FALSE)
```

- the *p*-value is < 0.001 ...

- ... but $\hat{\pi}$ = 0.5055 ...

- Let's talk about practical/clinical significance vs. statistical significance :)

## Confidence Intervals: CI for One Proportion

- The confidence interval for $\pi$ is found as follows,

$$ \hat{\pi} \pm z_{\alpha/2} \hat{\sigma}, $$

- where

$$ \hat{\pi} = \frac{y}{n} \ \ \text{ and } \ \ \hat{\sigma} = \sqrt{\frac{\hat{\pi}(1-\hat{\pi})}{n}} $$

## Confidence Intervals: R Syntax

- We again use either the [`binom.test()`](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/binom.test) function or the [`prop.test()`](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/prop.test) function.

- If we have $n \le 30$,

```{r, echo = TRUE, eval = FALSE}
binom.test(x = [number of successes], 
           n = [sample size])
```

- If we have $n > 30$,

```{r, echo = TRUE, eval = FALSE}
prop.test(x = [number of successes], 
          n = [sample size], 
          correct=FALSE)
```

- Note that we do not need to input either the hypothesized value or the alternative.

  - It does not change anything if you do include those, but make sure that you are specifying alternative = "two.sided".

## Confidence Intervals: Police

- Let's find the 95% CI for the police flashlight data.

```{r, echo = TRUE}
prop.test(x = 200, 
          n = 1200, 
          correct=FALSE)
```

- Thus, the 95% CI for $\pi$, the population failure rate is (14.67%, 18.88%).

## Confidence Intervals: Jackson Heart Study

- Let's find the 99% CI for the proportion of JHS participants that take medicine for high blood pressure.

```{r, echo = TRUE}
prop.test(x = 1331, 
          n = 1302+1331, 
          conf.level = 0.99,
          correct=FALSE)
```

- Thus, the 99% CI for $\pi$, the population proportion of southern African Americans taking high blood pressure medication is (48.04%, 53.06%).

## Bernoulli Expreiments: Two Populations

- Suppose we now have independent samples from two binomial populations with unknown parameters, $\pi_1$ and $\pi_2$. 

- Further assume that we have $y_1$ and $y_2$ successes for the random samples of sizes $n_1$ and $n_2$, respectively.

- We now have point estimates,

$$ \hat{\pi}_1 = \frac{y_1}{n_1} \ \ \text{ and } \ \ \hat{\pi}_2 = \frac{y_2}{n_2} $$

## Bernoulli Experiments: Two Populations

- We now want to compare populations 1 and 2.

- We will estimate $\pi_1 - \pi_2$ with $\hat{\pi}_1 - \hat{\pi}_2$, where,

$$ \hat{\pi}_1 - \hat{\pi}_2 = \frac{y_1}{n_1} - \frac{y_2}{n_2} $$

- If we have a "large sample" (i.e., $n_i\pi_i \ge 5$ **and** $n_i(1-\pi_i) \ge 5$) for $i = 1, \ 2$, we know

$$ \hat{\pi}_1 - \hat{\pi}_2 \sim N \left( \pi_1-\pi_2, \sqrt{\frac{\pi_1(1-\pi_1)}{n_1} + \frac{\pi_2(1-\pi_2)}{n_2}} \right) $$

## Hypothesis Testing: Test for Two Proportions

**Hypotheses**

|          Right Tail           |           Left Tail           |           Two Tails            |
|:----------------------:|:----------------------:|:----------------------:|
| $H_0: \ \pi_1- \pi_2 \le 0$ | $H_0: \ \pi_1 - \pi_2\ge 0$ |  $H_0: \ \pi_1 - \pi_2 = 0$  |
| $H_1: \ \pi_1 - \pi_2 > 0$  | $H_1: \ \pi_1 - \pi_2 < 0$  | $H_1: \ \pi_1 - \pi_2 \ne 0$ |

**Test Statistic**

$$ z_0 = \frac{\hat{\pi}_1 - \hat{\pi}_2}{\hat{\sigma}}, $$

- where

$$ \hat{\sigma} = \sqrt{\frac{\hat{\pi}_1(1-\hat{\pi}_1)}{n_1} + \frac{\hat{\pi}_2(1-\hat{\pi}_2)}{n_2}} $$

## Hypothesis Testing: R Syntax

- We again use the [`prop.test()`](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/prop.test) function.

```{r, echo = TRUE, eval = FALSE}
prop.test(x = c(x_1, x_2), 
          n = c(n_1, n_2), 
          alternative = [alternative],
          correct=FALSE)
```

- Note our assumption, $n_i\pi_i \ge 5$ **and** $n_i(1-\pi_i) \ge 5$ for $i = 1, \ 2$

## Hypothesis Testing: Pain Reduction

- Biofeedback is a treatment technique in which people are trained to improve their health by using signals from their own bodies. Specialists in many different fields use biofeedback to help their patients cope with pain. A study was conducted to compare a biofeedback treatment for chronic pain with an NSAID medical treatment. A group of 2,000 newly diagnosed chronic pain patients were randomly assigned to receive to one of the two treatments. After 6 weeks of treatments, the pain levels of the patients were assessed with the following results:

|             | Reduction in Pain | No Reduction in Pain |
|-------------|:-------------------:|:----------------------:|
| Biofeedback | 560               | 440                  |
| NSAID       | 680               | 320                  |


## Hypothesis Testing: Pain Reduction

|             | Reduction in Pain | No Reduction in Pain |
|-------------|-------------------|----------------------|
| Biofeedback | 560               | 440                  |
| NSAID       | 680               | 320                  |

- The proportion reduced in the biofeedback group,
$$ \hat{\pi}_{\text{B}} = \frac{560}{`r 560+440`} = `r 560/(560+440)` $$

- The proportion reduced in the NSAID group,
$$ \hat{\pi}_{\text{N}} = \frac{680}{`r 680+320`} = `r 680/(680+320)` $$

## Hypothesis Testing: Pain Reduction

- Let's determine if there is a difference in pain reduction between the two treatments. 
```{r, echo = TRUE}
prop.test(x = c(560, 680), 
          n = c(1000, 1000), 
          alternative = "two",
          correct=FALSE)
```

## Hypothesis Testing: Pain Reduction {.smaller}

**Hypotheses**

- $H_0: \ \pi_{\text{B}} = \pi_{\text{N}}$ 
- $H_1: \ \pi_{\text{B}} \ne \pi_{\text{N}}$

**Test Statistic and *p*-Value**

- $\chi^2_0 = 30.56$ or $z_0 = \sqrt{30.56} = `r round(sqrt(30.56),3)`$
- $p < 0.001$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that the proportion with reduced pain is different between the two treatment groups.

## Hypothesis Testing: Jackson Heart Study

- Let's again look at the JHS data to determine if there is a higher proportion of females taking blood pressure medication.

```{r, echo = TRUE}
table(data$BPmeds, data$sex)
```

- The proportion of females on medicine,
$$ \hat{\pi}_{\text{F}} = \frac{909}{`r 909+754`} = `r 909/(909+754)` $$

- The proportion of males on medicine,
$$ \hat{\pi}_{\text{M}} = \frac{422}{`r 422+548`} = `r 422/(422+548)` $$

## Hypothesis Testing: Jackson Heart Study

- Remember that order matters when inputting the data and the alternative,

```{r, echo = TRUE}
prop.test(x = c(909, 422), 
          n = c(1663, 970), 
          alternative = "greater",
          correct=FALSE)
```

## Hypothesis Testing: Jackson Heart Study {.smaller}

**Hypotheses**

- $H_0: \ \pi_{\text{F}} = \pi_{\text{M}}$ 
- $H_1: \ \pi_{\text{F}} \ne \pi_{\text{M}}$

**Test Statistic and *p*-Value**

- $\chi^2_0 = 30.498$ or $z_0 = \sqrt{30.498} = `r round(sqrt(30.498),3)`$
- $p < 0.001$

**Rejection Region**

- Reject $H_0$ if $p < \alpha$; $\alpha=0.05$

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that a higher proportion of females takes blood pressure medicine, as compared to males.

## Confidence Intervals: CI for Two Proportions

- The confidence interval for $\pi_1 - \pi_2$ is found as follows,

$$ (\hat{\pi}_1 - \hat{\pi}_2) \pm z_{\alpha/2} \hat{\sigma}, $$

- where

$$ \hat{\pi}_1 - \hat{\pi}_2 = \frac{y_1}{n_1} - \frac{y_2}{n_2} \ \ \text{ and } \ \ \hat{\sigma} = \sqrt{\frac{\hat{\pi}_1(1-\hat{\pi}_1)}{n_1} + \frac{\hat{\pi}_2(1-\hat{\pi}_2)}{n_2}} $$

## Confidence Intervals: R Syntax

- We again use either  the [`prop.test()`](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/prop.test) function.

```{r, echo = TRUE, eval = FALSE}
prop.test(x = c(x_1, x_2), 
          n = c(n_1, n_2), 
          correct=FALSE)
```

- Note that we do not need to input the alternative.

  - It does not change anything if you do, but make sure that you are specifying alternative = "two.sided".
  
## Confidence Intervals: Pain Reduction

- Let's find the 95% CI for $\pi_{\text{B}}-\pi_{\text{N}}$ for the pain reduction data.

```{r, echo = TRUE}
prop.test(x = c(560, 680), 
          n = c(1000, 1000), 
          alternative = "two",
          correct=FALSE)
```

- The 95% CI for $\pi_{\text{B}}-\pi_{\text{N}}$ is (-0.16, -0.08).

    - Because the interval is negative, it indicates that the proportion of pain reduction in the biofeedback group is smaller than that of the NSAID group.

## Confidence Intervals: Jackson Heart Study

- Let's find the 99% CI for $\pi_{\text{F}}-\pi_{\text{M}}$ for the JHS data.

```{r, echo = TRUE}
prop.test(x = c(909, 422), 
          n = c(1663, 970), 
          conf.level = 0.99,
          correct=FALSE)
```

- The 99% CI for $\pi_{\text{F}}-\pi_{\text{M}}$ is (0.06, 0.16).

    - Because the interval is positive, this indicates that the proportion of females on blood pressure medication is higher than that of males.































